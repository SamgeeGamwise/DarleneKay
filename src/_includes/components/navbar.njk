<nav aria-label="Primary">
  <a id="brand" class="logo-text h3 bold" href="{{ '/' | url }}">
  {% if branding == "roofing" %}

    {% image "/assets/images/logo_roofing.png", "Roofing logo" %}
  {% elseif branding == "painting" %}
    {% image "/assets/images/logo_painting.webp", "Painting logo" %}
  {% elseif branding == "main" %}
    {% image "/assets/images/logo_painting.webp", "Painting logo" %}
    {% image "/assets/images/logo_roofing.png", "Roofing logo" %}
  {% endif %}
  </a>
  <div class="nav-desktop">

    {# Menu #}
    <ul class="nav-menu">
    {% for item in site.nav %}
      {% set isActive = (page.url == item.href) or (page.url == '/' and item.href == '/') %}
      {% set hasChildren = item.children %}
      {% set childActive = false %}
      {% if hasChildren %}
        {% for child in item.children %}
          {% if page.url == child.href %}
            {% set childActive = true %}
          {% endif %}
        {% endfor %}
      {% endif %}
      {% set parentActive = isActive or childActive %}

      {% if hasChildren %}
        <li>
          {% if item.href %}
            <a href="{{ item.href | url }}" {% if parentActive %} aria-current="page" class="nav-item active-nav"{% else %} class="nav-item"{% endif %}>{{ item.text }}<i class="fa-solid fa-caret-down"></i></a>
          {% else %}
            <span class="nav-item{% if parentActive %} active-nav{% endif %}">{{ item.text }} <i class="fa-solid fa-caret-down"></i></span>
          {% endif %}
          <div class="nav-sub-menu">
            <ul>
            {% for child in item.children %}
              {% set isChild = page.url == child.href %}
              <li>
                {% if child.href %}
                  <a href="{{ child.href | url }}" {% if isChild %} aria-current="page" class="sub-nav-item active-nav"{% else %} class="sub-nav-item"{% endif %}>{{ child.text }}</a>
                {% else %}
                  <span class="sub-nav-item{% if isChild %} active-nav{% endif %}">{{ child.text }}</span>
                {% endif %}
              </li>
            {% endfor %}
            </ul>
          </div>
        </li>
      {% else %}
        <li>
          {% if item.href %}
            <a href="{{ item.href | url }}" {% if parentActive %} aria-current="page" class="nav-item active-nav"{% else %} class="nav-item"{% endif %}>{{ item.text }}</a>
          {% else %}
            <span class="nav-item{% if parentActive %} active-nav{% endif %}">{{ item.text }}</span>
          {% endif %}
        </li>
      {% endif %}
    {% endfor %}
    </ul>
  </div>

  <div class="nav-mobile">
    <button id="menu-button" class="nav-mobile__trigger" type="button" aria-expanded="false" aria-controls="menu">
      <i id="menu-button-icon" class="fa-solid fa-bars" aria-hidden="true"></i>
    </button>
      <ul id="menu" class="mobile-menu hidden" data-mobile-menu>
      {% for item in site.nav %}
        {% set isActive = (page.url == item.href) or (page.url == '/' and item.href == '/') %}
        {% set hasChildren = item.children %}
        {% set childActive = false %}
        {% if hasChildren %}
          {% for child in item.children %}
            {% if page.url == child.href %}
              {% set childActive = true %}
            {% endif %}
          {% endfor %}
        {% endif %}
        {% set parentActive = isActive or childActive %}
        {% set submenuId = 'mobile-submenu-' ~ loop.index %}
        <li class="mobile-menu__item{% if hasChildren %} has-children{% endif %}">
          {% if hasChildren %}
            <div class="mobile-menu__parent">
              {% if item.href %}
                <a href="{{ item.href | url }}" class="mobile-menu__link{% if parentActive %} active-nav{% endif %}" {% if parentActive %}aria-current="page"{% endif %}>{{ item.text }}</a>
              {% else %}
                <span class="mobile-menu__link{% if parentActive %} active-nav{% endif %}">{{ item.text }}</span>
              {% endif %}
              <button class="mobile-menu__toggle" type="button" aria-expanded="false" aria-controls="{{ submenuId }}" data-mobile-submenu-toggle aria-label="Toggle {{ item.text }} submenu">
                <i class="fa-solid fa-chevron-down mobile-menu__toggle-icon" aria-hidden="true"></i>
              </button>
            </div>
            <ul class="mobile-menu__submenu hidden" id="{{ submenuId }}">
            {% for child in item.children %}
              {% set isChild = page.url == child.href %}
              <li class="mobile-menu__submenu-item">
                {% if child.href %}
                  <a href="{{ child.href | url }}" class="mobile-menu__submenu-link{% if isChild %} active-nav{% endif %}" {% if isChild %}aria-current="page"{% endif %}>{{ child.text }}</a>
                {% else %}
                  <span class="mobile-menu__submenu-link{% if isChild %} active-nav{% endif %}">{{ child.text }}</span>
                {% endif %}
              </li>
            {% endfor %}
            </ul>
          {% else %}
            {% if item.href %}
              <a href="{{ item.href | url }}" class="mobile-menu__link{% if parentActive %} active-nav{% endif %} no-child" {% if parentActive %}aria-current="page"{% endif %}>{{ item.text }}</a>
            {% else %}
              <span class="mobile-menu__link{% if parentActive %} active-nav{% endif %} no-child">{{ item.text }}</span>
            {% endif %}
          {% endif %}
        </li>
      {% endfor %}
      </ul>
  </div>
</nav>
