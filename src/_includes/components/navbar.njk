<nav aria-label="Primary">
  <a id="brand" class="logo-text h3 bold" href="{{ '/' | url }}">
  {% if branding == "roofing" %}
    <img src="{{ '/assets/images/logo_roofing.png' | url }}" alt="Roofing logo">
    {# <span class="site-name">{{ site.site_name_roofing }}</span> #}
  {% elseif branding == "painting" %}
    <img src="{{ '/assets/images/logo_painting.webp' | url }}" alt="Painting logo">
    {# <span class="site-name painting">{{ site.site_name_painting }}</span> #}
  {% elseif branding == "main" %}
    <img src="{{ '/assets/images/logo_roofing.png' | url }}" alt="Roofing logo">
    <img src="{{ '/assets/images/logo_painting.webp' | url }}" alt="Painting logo">
  {% endif %}
  </a>
  <div class="nav-desktop">

    {# Menu #}
    <ul class="nav-menu">
    {% for item in site.nav %}
      {% set isActive = (page.url == item.href) or (page.url == '/' and item.href == '/') %}
      {% set hasChildren = item.children %}
      {% set childActive = false %}
      {% if hasChildren %}
        {% for child in item.children %}
          {% if page.url == child.href %}
            {% set childActive = true %}
          {% endif %}
        {% endfor %}
      {% endif %}
      {% set parentActive = isActive or childActive %}
        {% if hasChildren %}
          <li>
            <a href="{{ item.href | url }}" {% if parentActive %} aria-current="page" class="nav-item active-nav" {% else %} class="nav-item" {% endif %}>{{ item.text }}<i class="fa-solid fa-caret-down"></i></a>
            {# Sub Menu #}
                <div class="nav-sub-menu">
                  <ul>
              {% for child in item.children %}
                    {% set isChild = page.url == child.href %}
                    <li>
                      <a href="{{ child.href | url }}" {% if isChild %} aria-current="page" class="sub-nav-item active-nav" {% else %} class="sub-nav-item" {% endif %}>{{ child.text }}</a>
                    </li>
              {% endfor %}
                  </ul>
                </div>
          </li>

          {% else %}
            <li>
              <a href="{{ item.href | url }}" {% if parentActive %} aria-current="page" class="nav-item active-nav" {% else %} class="nav-item" {% endif %}>{{ item.text }}</a>
            </li>
          {% endif %}
    {% endfor %}
    </ul>

  </div>
  <div class="nav-mobile">
    <button id="menu-button" class="nav-mobile__trigger" type="button" aria-expanded="false" aria-controls="menu">
      <i id="menu-button-icon" class="fa-solid fa-bars" aria-hidden="true"></i>
    </button>
    <ul id="menu" class="mobile-menu hidden" data-mobile-menu>
    {% for item in site.nav %}
      {% set isActive = (page.url == item.href) or (page.url == '/' and item.href == '/') %}
      {% set hasChildren = item.children %}
      {% set childActive = false %}
      {% if hasChildren %}
        {% for child in item.children %}
          {% if page.url == child.href %}
            {% set childActive = true %}
          {% endif %}
        {% endfor %}
      {% endif %}
      {% set parentActive = isActive or childActive %}
      {% set submenuId = 'mobile-submenu-' ~ loop.index %}
      <li class="mobile-menu__item{% if hasChildren %} has-children{% endif %}">
        {% if hasChildren %}
          <div class="mobile-menu__parent">
            <a href="{{ item.href | url }}" class="mobile-menu__link{% if parentActive %} active-nav{% endif %}" {% if parentActive %}aria-current="page"{% endif %}>{{ item.text }}</a>
            <button class="mobile-menu__toggle" type="button" aria-expanded="false" aria-controls="{{ submenuId }}" data-mobile-submenu-toggle aria-label="Toggle {{ item.text }} submenu">
              <i class="fa-solid fa-chevron-down mobile-menu__toggle-icon" aria-hidden="true"></i>
            </button>
          </div>
          <ul class="mobile-menu__submenu hidden" id="{{ submenuId }}">
          {% for child in item.children %}
            {% set isChild = page.url == child.href %}
            <li class="mobile-menu__submenu-item">
              <a href="{{ child.href | url }}" class="mobile-menu__submenu-link{% if isChild %} active-nav{% endif %}" {% if isChild %}aria-current="page"{% endif %}>{{ child.text }}</a>
            </li>
          {% endfor %}
          </ul>
        {% else %}
          <a href="{{ item.href | url }}" class="mobile-menu__link{% if parentActive %} active-nav{% endif %} no-child" {% if parentActive %}aria-current="page"{% endif %}>{{ item.text }}</a>
        {% endif %}
      </li>
    {% endfor %}
    </ul>
  </div>
</nav>
